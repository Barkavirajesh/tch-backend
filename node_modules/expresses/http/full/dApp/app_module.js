const myapp = angular.module("myApp", []);

myapp.controller("myctrl", function ($scope, $http) {
  $scope.name = "Dev";

  $scope.login = {};

  $scope.msg = "";

  $scope.user = {};
  $scope.newuser = {};

  $scope.users = [];

  $scope.isLogin = false;

  $scope.isUpdate = false;

  $scope.getAll = function () {
    $http.get("/api/users/").then((res) => {
      if (res.data.users) {
        $scope.users = res.data.users;
      } else {
        $scope.msg = res.data.message;
      }
    });
  };

  $scope.LoginUser = function () {
    console.log("Hello");
    $http.post("/api/login/", $scope.login).then((res) => {
      if (res.data.user) {
        $scope.user = res.data.user;
        alert("Login Success");
        $scope.isLogin = true;
        $scope.getAll();
      } else {
        alert(res.data.message);
        $scope.isLogin = false;
      }
    });
  };

  $scope.addUser = function () {
    $http.post("/api/adduser/", $scope.newuser).then((res) => {
      if (res.data.message) {
        alert(res.data.message);
        $scope.newuser = {};
        $scope.getAll();
      } else {
        alert("User not added");
      }
    });
  };

  $scope.deleteUser = function (id) {
    $http.delete("/api/deleteuser/" + id).then((res) => {
      if (res.data.message) {
        alert(res.data.message);
        $scope.getAll();
      } else {
        alert("User not deleted");
      }
    });
  };

  $scope.update = function (user) {
    $scope.isUpdate = true;
    $scope.newuser = user;
  };

  $scope.updateUser = function () {
    if (!$scope.newuser || !$scope.newuser._id) {
      alert("No user selected for update or user ID missing.");
      return;
    }
    $http
      .put("/api/updateuser/" + $scope.newuser._id, $scope.newuser)
      .then((res) => {
        if (res.data.message) {
          alert(res.data.message);
          $scope.newuser = {};
          $scope.isUpdate = false;
          $scope.getAll();
        } else {
          alert("User not updated");
        }
      });
  };

  $scope.num = 0;

  $scope.change = function (str) {
    if ($scope.num >= 0) {
      if (str == "+") {
        $scope.num += 2;
      } else {
        $scope.num -= 2;
      }
    }
  };
});
